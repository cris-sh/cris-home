---
import { useTranslations } from "../../i18n/utils";
import { languages } from "../../i18n/pages";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params;
const t = useTranslations(lang as keyof typeof languages);

const projects = (
  await getCollection(
    "projects",
    (project: { id: string; data: { lang: string } }) => {
      const matches =
        lang === "es"
          ? project.id.startsWith("es/") || project.data.lang === "es"
          : project.id.startsWith("en/") ||
            !project.data.lang ||
            project.data.lang === "en";
      return matches;
    }
  )
).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const resume = {
  name: t("resume.name"),
  title: t("resume.description"),
  description:
    lang === "es"
      ? "Ingeniero de software apasionado por el desarrollo web full-stack, especializado en JavaScript/TypeScript y frameworks modernos."
      : "Passionate software engineer with a focus on full-stack web development, specialized in JavaScript/TypeScript and modern frameworks.",
  website: "enux.dev",
  location: "Bogotá, Colombia",
  timezone: "GMT-5",
  email: "contact@enux.dev",
  github: "https://github.com/cris-sh",
  linkedin: "https://linkedin.com/in/enux",
  photoUrl: "/img/avatar/enux.webp",

  about: t("resume.about"),
  experience: t("resume.experience"),
  education: t("resume.education"),
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{resume.name} - CV</title>
    <link rel="icon" type="image/svg+xml" href={resume.photoUrl} />
    <BaseHead title={`${resume.name} - CV`} description={resume.description} />
    <style>
      @font-face {
        font-family: "Geist";
        src: url("/fonts/Geist-Regular.ttf") format("truetype");
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: "Geist";
        src: url("/fonts/Geist-Bold.ttf") format("truetype");
        font-weight: 700;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: "GeistMono";
        src: url("/fonts/GeistMono-Variable.ttf") format("truetype-variations");
        font-weight: 100 900;
        font-style: normal;
        font-display: swap;
      }

      :root {
        --foreground: oklch(0.2 0 0);
        --background: oklch(0.99 0 0);
        --accent: oklch(0.2 0 0);
        --muted: oklch(0.6 0 0);
        --border: oklch(0.9 0 0);
      }

      body {
        font-family: "Geist", sans-serif;
        background-color: var(--background);
        color: var(--foreground);
        line-height: 1.6;
      }

      .mono {
        font-family: "GeistMono", monospace;
      }

      @media print {
        body {
          background-color: white;
          color: black;
          font-size: 11pt;
        }
        .no-print {
          display: none !important;
        }
        .page-container {
          padding: 0;
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body class="antialiased selection:bg-zinc-100">
    <div class="max-w-2xl mx-auto px-6 py-12 md:py-20 page-container">
      <!-- Lang Selector -->
      <nav class="flex justify-end gap-3 mb-12 no-print text-xs mono">
        <a href="/cv" class={lang === "en" ? "text-black font-bold" : "text-zinc-400 hover:text-black"}>EN</a>
        <span class="text-zinc-200">/</span>
        <a href="/es/cv" class={lang === "es" ? "text-black font-bold" : "text-zinc-400 hover:text-black"}>ES</a>
      </nav>

      <header class="mb-12">
        <div class="flex flex-col-reverse md:flex-row md:items-center justify-between gap-6">
          <div class="flex-1">
            <h1 class="text-3xl font-bold tracking-tighter mb-1 select-none">{resume.name}</h1>
            <p class="text-zinc-500 font-medium mb-4">{resume.title}</p>
            
            <div class="flex flex-wrap gap-x-4 gap-y-2 text-sm mono text-zinc-500">
              <span class="flex items-center gap-1.5">
               <svg class="size-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                <a href={`https://${resume.website}`} class="hover:text-black underline decoration-zinc-200 underline-offset-4">{resume.website}</a>
              </span>
              <span class="flex items-center gap-1.5">
                <svg class="size-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>
                <a href={`mailto:${resume.email}`} class="hover:text-black underline decoration-zinc-200 underline-offset-4">{resume.email}</a>
              </span>
              <span class="flex items-center gap-1.5">
                <svg class="size-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-9 12-9 12s-9-6-9-12a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                {resume.location}
              </span>
            </div>
          </div>
          <img
            src={resume.photoUrl}
            alt={resume.name}
            class="size-24 rounded-full grayscale hover:grayscale-0 transition-all duration-500 border border-zinc-100"
          />
        </div>
      </header>

      <section class="mb-12">
        <h2 class="text-sm font-bold uppercase tracking-widest text-zinc-400 mb-4 select-none">About</h2>
        <div class="space-y-4 text-zinc-600 leading-relaxed italic">
          {typeof resume.about === 'string' ? <p>{resume.about}</p> : resume.about.map((p: string) => <p>{p}</p>)}
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-sm font-bold uppercase tracking-widest text-zinc-400 mb-6 select-none">Work</h2>
        <div class="space-y-10">
          {
            resume.experience.map((job: any) => (
              <div class="relative pl-4 border-l border-zinc-100">
                <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-1 mb-2">
                  <h3 class="font-bold text-zinc-900">{job.company}</h3>
                  <span class="text-xs mono text-zinc-400 uppercase">{job.period}</span>
                </div>
                <p class="text-sm font-medium text-zinc-500 mb-3">{job.position}</p>
                <p class="text-[13px] text-zinc-600 leading-relaxed">
                  {job.description}
                </p>
              </div>
            ))
          }
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-sm font-bold uppercase tracking-widest text-zinc-400 mb-6 select-none">Education</h2>
        <div class="space-y-8">
          {
            resume.education.map((edu: any) => (
              <div class="flex flex-col md:flex-row md:items-baseline justify-between gap-1">
                <div>
                  <h3 class="font-bold text-zinc-900">{edu.institution}</h3>
                  <p class="text-sm text-zinc-500">{edu.degree}</p>
                </div>
                <span class="text-xs mono text-zinc-400 uppercase">{edu.period}</span>
              </div>
            ))
          }
        </div>
      </section>

      {
        projects.length > 0 && (
          <section class="mb-12">
            <h2 class="text-sm font-bold uppercase tracking-widest text-zinc-400 mb-6 select-none">Selected Works</h2>
            <div class="grid grid-cols-1 gap-4">
              {projects.slice(0, 4).map((project) => (
                <div class="group p-4 -mx-4 rounded-xl hover:bg-zinc-50 transition-colors border border-transparent hover:border-zinc-100">
                  <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-zinc-900">
                      <a href={`/${lang}/projects/${project.id.split('/').pop()}/`} class="flex items-center gap-1 hover:underline underline-offset-4 decoration-zinc-300">
                        {project.data.title}
                        <svg class="size-3 text-zinc-300 group-hover:text-zinc-400 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7h10v10"></path><path d="M7 17 17 7"></path></svg>
                      </a>
                    </h3>
                  </div>

                  <p class="text-sm text-zinc-500 mb-4 line-clamp-2">{project.data.description}</p>

                  <div class="flex flex-wrap gap-2">
                    {project.data.tags.map((tag: string) => (
                      <span class="px-2 py-0.5 rounded bg-zinc-100 text-zinc-500 text-[10px] font-bold uppercase tracking-wider mono">
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>
              ))}
            </div>
            <div class="mt-8 flex justify-center no-print">
               <a href={`/${lang}/projects/`} class="text-xs font-bold uppercase tracking-tighter text-zinc-400 hover:text-black transition-colors border-b border-zinc-100 pb-1">
                  View full archive
                </a>
            </div>
          </section>
        )
      }

      <footer class="mt-20 pt-8 border-t border-zinc-100 flex justify-between items-center no-print">
        <p class="text-[10px] mono text-zinc-400 uppercase tracking-widest">
          {resume.location} · <span id="current-time"></span>
        </p>
        <button
          id="print-button"
          class="size-8 flex items-center justify-center rounded-full bg-zinc-50 text-zinc-400 hover:bg-zinc-900 hover:text-white transition-all cursor-pointer"
          aria-label="Print CV"
        >
          <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
        </button>
      </footer>
    </div>

    <script define:vars={{ lang }}>
      function updateTime() {
        const bogotaTime = new Intl.DateTimeFormat(
          lang === "es" ? "es-CO" : "en-US",
          {
            timeZone: "America/Bogota",
            hour: "2-digit",
            minute: "2-digit",
            hour12: true,
          }
        ).format(new Date());

        const el = document.getElementById("current-time");
        if (el) el.textContent = bogotaTime;
      }

      updateTime();
      setInterval(updateTime, 60000);

      document
        .getElementById("print-button")
        ?.addEventListener("click", () => window.print());
    </script>
  </body>
</html>
